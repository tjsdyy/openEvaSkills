<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Humanizer-zh Form</title>
  <script src="openeva-portal://_libs/react.production.min.js"></script>
  <script src="openeva-portal://_libs/react-dom.production.min.js"></script>
  <script src="openeva-portal://_libs/babel.min.js"></script>
  <style>
    :root {
      --bg: #ffffff;
      --fg: #1a1a2e;
      --muted: #6b7280;
      --border: #e5e7eb;
      --accent: #7c3aed;
      --accent-hover: #6d28d9;
      --card: #f9fafb;
      --input-bg: #ffffff;
    }
    .dark {
      --bg: #0f0f23;
      --fg: #e5e7eb;
      --muted: #9ca3af;
      --border: #374151;
      --accent: #8b5cf6;
      --accent-hover: #7c3aed;
      --card: #1a1a2e;
      --input-bg: #1e1e36;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--bg);
      color: var(--fg);
      overflow: hidden;
    }
    .form-root {
      display: flex;
      flex-direction: column;
      height: 320px;
      padding: 12px 16px;
      gap: 10px;
    }
    textarea {
      flex: 1;
      width: 100%;
      resize: none;
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 10px 12px;
      font-size: 13px;
      line-height: 1.5;
      background: var(--input-bg);
      color: var(--fg);
      outline: none;
      transition: border-color 0.2s;
    }
    textarea:focus { border-color: var(--accent); }
    textarea::placeholder { color: var(--muted); }
    .controls {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .select-wrap {
      position: relative;
    }
    select {
      appearance: none;
      padding: 6px 28px 6px 10px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 12px;
      background: var(--input-bg);
      color: var(--fg);
      cursor: pointer;
      outline: none;
    }
    select:focus { border-color: var(--accent); }
    .select-wrap::after {
      content: '';
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      border: 4px solid transparent;
      border-top-color: var(--muted);
      pointer-events: none;
    }
    .chips {
      display: flex;
      gap: 4px;
    }
    .chip {
      padding: 5px 12px;
      border: 1px solid var(--border);
      border-radius: 16px;
      font-size: 11px;
      cursor: pointer;
      background: transparent;
      color: var(--muted);
      transition: all 0.2s;
    }
    .chip:hover { border-color: var(--accent); color: var(--fg); }
    .chip.active {
      background: var(--accent);
      color: #fff;
      border-color: var(--accent);
    }
    .spacer { flex: 1; }
    .char-count {
      font-size: 11px;
      color: var(--muted);
    }
    .submit-btn {
      padding: 6px 20px;
      border: none;
      border-radius: 10px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      background: var(--accent);
      color: #fff;
      transition: background 0.2s;
    }
    .submit-btn:hover { background: var(--accent-hover); }
    .submit-btn:disabled { opacity: 0.5; cursor: default; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;

    function App() {
      const [text, setText] = useState('');
      const [style, setStyle] = useState('auto');
      const [intensity, setIntensity] = useState('medium');
      const [isDark, setIsDark] = useState(false);

      // Query theme on mount
      useEffect(() => {
        const reqId = crypto.randomUUID();
        function onMsg(e) {
          if (e.data?.type === 'openeva:theme' && e.data.requestId === reqId) {
            setIsDark(e.data.payload?.mode === 'dark');
            window.removeEventListener('message', onMsg);
          }
        }
        window.addEventListener('message', onMsg);
        window.parent.postMessage({ type: 'openeva:getTheme', requestId: reqId }, '*');
        return () => window.removeEventListener('message', onMsg);
      }, []);

      useEffect(() => {
        document.documentElement.className = isDark ? 'dark' : '';
      }, [isDark]);

      function handleSubmit() {
        if (!text.trim()) return;

        const parts = ['[Skill: Humanizer-zh]'];
        parts.push(`Text: ${text.trim()}`);
        if (style !== 'auto') parts.push(`Style: ${style}`);
        parts.push(`Intensity: ${intensity}`);

        window.parent.postMessage({
          type: 'openeva:sendPrompt',
          payload: { message: parts.join('\n') }
        }, '*');
      }

      const styleOptions = [
        { value: 'auto', label: 'Auto' },
        { value: 'formal', label: 'Formal' },
        { value: 'casual', label: 'Casual' },
        { value: 'technical', label: 'Technical' },
      ];

      const intensityOptions = [
        { value: 'light', label: 'Light' },
        { value: 'medium', label: 'Medium' },
        { value: 'aggressive', label: 'Aggressive' },
      ];

      return (
        <div className="form-root">
          <textarea
            value={text}
            onChange={e => setText(e.target.value)}
            placeholder="Paste AI-generated text here to humanize..."
          />
          <div className="controls">
            <div className="select-wrap">
              <select value={style} onChange={e => setStyle(e.target.value)}>
                {styleOptions.map(o => (
                  <option key={o.value} value={o.value}>{o.label}</option>
                ))}
              </select>
            </div>
            <div className="chips">
              {intensityOptions.map(o => (
                <button
                  key={o.value}
                  className={`chip ${intensity === o.value ? 'active' : ''}`}
                  onClick={() => setIntensity(o.value)}
                >
                  {o.label}
                </button>
              ))}
            </div>
            <span className="spacer" />
            <span className="char-count">{text.length} chars</span>
            <button
              className="submit-btn"
              onClick={handleSubmit}
              disabled={!text.trim()}
            >
              Humanize
            </button>
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
